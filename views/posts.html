<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    backgroundImage: {
                        'hero-pattern': "url('./images/landscape.jpg')",
                    },
                    colors: {
                        bgInput: 'hsl(240deg 6% 93%)',
                        accentColor: '#007fdc',
                        // lightAccentColor: 'rgba(78, 199, 208)',
                        accentColorLight: 'rgba(49, 107, 131, .4)',
                        darkerblue: 'rgba(30, 53, 92, 1)',
                        lightblue: 'rgb(44 123 229)',
                        lightAccentColor: 'rgba(0, 127, 220, 1)',
                        complementary: 'rgb(208, 199, 178)',
                        lightwhitepurple: '#fcfbfc',
                        lighttextgray: '#B5B5B5',
                    },
                    width: {
                        'w-3/20': '25%',
                        'w-22/55': '45%'
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="css/createPost.css">
    <title>Posts</title>
    <style>
        
    </style>
</head>

<body class="h-screen">

    <div class="flex justify-between items-center">

        <div class="w-1/6 h-screen border-2 px-8 py-10 bg-lightwhitepurple">
            <h1 class="text-4xl font-bold mb-8 text-accentColor">AG Rwanda</h1>
            <hr>
            <ul class="mt-8 flex flex-col justify-between items-start gap-6">
                <li class="font-semibold flex justify-between items-center gap-2">
                    <!-- <ion-icon name="grid-outline" class="text-lg"></ion-icon> -->
                    <img src="./images/menu.png" alt="" class="w-4">
                    <a href="" class="">Overview</a>
                </li>
                <li class="font-semibold flex justify-between items-center gap-2">
                    <img src="./images/more.png" alt="" class="w-4">
                    <a href="http://localhost:4400/posts.html" class="text-accentColor">Posts</a>
                </li>
                <li class="font-semibold flex justify-between items-center gap-2">
                    <img src="./images/store.png" alt="" class="w-4">
                    <a href="">Markets</a>
                </li>
                <li class="font-semibold flex justify-between items-center gap-2">
                    <img src="./images/deal.png" alt="" class="w-4">
                    <a href="">Deals</a>
                </li>
                <li class="font-semibold flex justify-between items-center gap-2">
                    <img src="./images/user.png" alt="" class="w-4">
                    <a href="">Profile</a>
                </li>
                <li class="font-semibold flex justify-between items-center gap-2">
                    <img src="./images/setting.png" alt="" class="w-4">
                    <a href="">Settings</a>
                </li>
            </ul>
        </div>

        <div class="h-screen w-5/6 border-2 flex justify-between">
            <div class="w-full w-3/4 pt-10 border-2">
                <div class="flex justify-between items-center mb-10 border-b-2 px-12 pb-6">
                    <div>
                        <h3 class="font-bold text-4xl text-darkerblue">Hello John</h3>
                        <p class="text-sm text-lighttextgray">Let's continue growing today!</p>
                    </div>
                    <div class="border-2 px-3 py-2 rounded-full">
                        <input type="text" placeholder="Search Here">
                        <button>
                            <ion-icon name="search-outline"></ion-icon>
                        </button>
                    </div>
                    <div class="w-1/4 flex justify-between items-center text-xl">
                        <button>
                            <ion-icon name="notifications-outline"></ion-icon>
                        </button>
                        <button onclick="togglePopup()">
                            <ion-icon name="add-outline"></ion-icon>
                        </button>
                        <button>
                            <ion-icon name="person-outline"></ion-icon>
                        </button>
                    </div>
                </div>

                <div id="posts-container" class="flex justify-between items-center gap-4 px-4 flex-wrap">
                    <!-- <div class="w-1/3 border-2 p-4">
                        <h2 class="text-5xl font-bold text-accentColor mb-6">Maize</h2>
                        <p class="mb-6 text-base">
                            Lorem ipsum dolor sit amet consectetur adipisicing elit. Ex accusamus nesciunt aliquam quidem a distinctio!
                        </p>
                        <div class="flex justify-between items-center gap-4">
                            <button class="w-1/2 px-3 py-px border border-accentColor">Edit</button>
                            <button class="w-1/2 px-3 py-px border border-accentColor">Delete</button>
                        </div>
                    </div> -->

                    <!-- <div class="w-1/3 border-2 p-4">
                        <h2 class="text-5xl font-bold text-accentColor mb-6">Maize</h2>
                        <p class="mb-6 text-base">
                            Lorem ipsum dolor sit amet consectetur adipisicing elit. Ex accusamus nesciunt aliquam quidem a distinctio!
                        </p>
                        <div class="flex justify-between items-center gap-4">
                            <button class="w-1/2 px-3 py-px border border-accentColor">Edit</button>
                            <button class="w-1/2 px-3 py-px border border-accentColor">Delete</button>
                        </div>
                    </div> -->

                    <!-- <div class="w-1/3 border-2 p-4">
                        <div></div>
                        <h2 class="text-5xl font-bold text-accentColor mb-6">Maize</h2>
                        <p class="mb-6 text-base">
                            Lorem ipsum dolor sit amet consectetur adipisicing elit. Ex accusamus nesciunt aliquam quidem a distinctio!
                        </p>
                        <p class="mb-6 text-lg font-bold text-accentColor">
                            Quantity: <span class="text-sm text-black font-normal">20Kg</span>
                        </p>
                        <div class="flex justify-between items-center gap-4">
                            <button class="w-1/2 px-3 py-px border border-accentColor">Edit</button>
                            <button class="w-1/2 px-3 py-px border border-accentColor">Delete</button>
                        </div>
                    </div> -->
                </div>

            </div>

            <div class="w-1/3 border-2 pt-10 px-8">
                <h3 class="text-darkerblue font-bold text-3xl mb-10">Profile</h3>
                <div>
                    <img src="./images/91.jpg" alt="" class="rounded-full border-2 border-accentColor px-2 py-2 mx-auto">
                    <div class="text-center mb-2">
                        <p class="text-3xl font-bold">John Doe</p>
                        <p class="text-sm text-lighttextgray">Smallholder Farmer</p>
                    </div>
                    <div class="text-center">Lorem ipsum dolor sit amet sint temporibus saepe nobis odio consectetur adipisicing elit. Velit magnam sint temporibus saepe nobis odio dolor sit amet sint temporibus saepe nobis odio consectetur eveniet doloremque vel ut similique!</div>
                </div>
                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-4">Recent Activity</h3>
                    <div class="px-6">
                        <div class="flex gap-3 items-center mb-4">
                            <ion-icon name="person-outline" class="text-4xl border-2 rounded-full px-px py-px border-black"></ion-icon>
                            <div>
                                <p class="text-base font-semibold">Amit Das <span class="font-normal">started a deal with you</span></p>
                                <p class="text-sm text-lighttextgray font-semibold">2hr ago</p>
                            </div>
                        </div>
                        <div class="flex gap-3 items-center mb-4">
                            <ion-icon name="person-outline" class="text-4xl border-2 rounded-full px-px py-px border-black"></ion-icon>
                            <div>
                                <p class="text-base font-semibold">Kayitare Keith <span class="font-normal">closed a deal with you</span></p>
                                <p class="text-sm text-lighttextgray font-semibold">2hr ago</p>
                            </div>
                        </div>
                        <div class="flex gap-3 items-center mb-4">
                            <ion-icon name="person-outline" class="text-4xl border-2 rounded-full px-px py-px border-black"></ion-icon>
                            <div>
                                <p class="text-base font-semibold">Keza Faith <span class="font-normal">interacted with your post</span></p>
                                <p class="text-sm text-lighttextgray font-semibold">2hr ago</p>
                            </div>
                        </div>
                        <!-- <div class="flex gap-3 items-center mb-4">
                            <ion-icon name="person-outline" class="text-4xl border-2 rounded-full px-px py-px border-black"></ion-icon>
                            <div>
                                <p class="text-base font-semibold">Amit Das <span class="font-normal">started a deal with you</span></p>
                                <p class="text-sm text-lighttextgray font-semibold">2hr ago</p>
                            </div>
                        </div> -->
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="popup" id="popup-1">
        <div class="overlay">
            <div class="content text-white">
                <div class="close-btn" onclick="togglePopup()">&times;</div>
                <div class="flex justify-between gap-8">
                    <div>
                        <h2 class="mb-8">CREATE A NEW POST</h2>
                        <form action="" class="flex flex-col gap-4 justify-between items-center w-full h-full" id="new-post-form">
                            <div>
                                <label for="">Post Name</label>
                                <input type="text" class="text-black" id="postName">
                            </div>
                            <div>
                                <label for="">Description</label>
                                <input type="text" class="text-black" id="description">
                            </div>
                            <div>
                                <label for="">Quantity in Kilograms</label>
                                <input type="text" class="text-black" id="quantity">
                            </div>
                            <input type="submit" value="Create New Post" class="" />
                            <!-- <button>Create New Post</button> -->
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="popup" id="popup-2">
        <div class="overlay">
            <div class="content text-white">
                <div class="close-btn" onclick="togglePopup2()">&times;</div>
                <div class="flex justify-between gap-8">
                    <div>
                        <h2 class="mb-8">UPDATE POST</h2>
                        <form action="" class="flex flex-col gap-4 justify-between items-center w-full h-full" id="update-post-form">
                            <div>
                                <label for="">Post Name</label>
                                <input type="text" class="text-black" id="postName-update">
                            </div>
                            <div>
                                <label for="">Description</label>
                                <input type="text" class="text-black" id="description-update">
                            </div>
                            <div>
                                <label for="">Quantity in Kilograms</label>
                                <input type="text" class="text-black" id="quantity-update">
                            </div>
                            <input type="submit" value="Update Post" class="" />
                            <!-- <button>Create New Post</button> -->
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPT TO EXECUTE REQUEST TO REST APIs -->
    <script>
        // Popup
        function togglePopup() {
            document.getElementById('popup-1').classList.toggle("active");
            console.log("CREATE NEW POST");
        }

        let elements = [];
        let elementID;
        let position;
        
        // MAKING A REQUEST TO THE REST API TO FETCH POSTS
        async function getPosts() {
            const response = await fetch('http://localhost:4400/farmer/posts');
            const data = await response.json();
            console.log(data);
            // console.log(data.postName, data.description, data.quantity);
            data.forEach((post, index) => {
                let html = `<div class="w-5/12 border-2 p-4 relative">
                        <p class="absolute top-0 opacity-0 post-id">${post.id}</p>
                        <h2 class="text-5xl font-bold text-accentColor mb-6">${post.postName}</h2>
                        <p class="mb-6 text-base">
                            ${post.description}
                        </p>
                        <p class="mb-6 text-lg font-bold text-accentColor">
                            Quantity: <span class="text-sm text-black font-normal">${post.quantity}Kg</span>
                        </p>
                        <div class="flex justify-between items-center gap-4">
                            <button id="${index + 1}" class="w-1/2 px-3 py-px border border-accentColor edit-btn" onclick="togglePopup2()">Edit</button>
                            <button id="delete-${index + 1}" class="w-1/2 px-3 py-px border border-accentColor delete-btn">Delete</button>
                        </div>
                    </div>`
                document.getElementById('posts-container').innerHTML += html;
            });

            for (let i = 1; i <= 100; i++) {
                elements.push(document.getElementById(i));
            }
            console.log("POST FUNCTION IS EXECUTING");
            console.log(document.getElementById('1'));
            console.log(elements);
            elements.forEach((element, index) => {
                element.addEventListener('click', () => {
                    position = index + 1
                    console.log("IT IS CLICKED AND HAS ID: " + position);
                })
            })
            // console.log("ELEMENT ID: ");
        }
        getPosts();


        const newPostForm = document.getElementById('new-post-form');
        newPostForm.addEventListener('submit', (e) => {
            e.preventDefault();
            console.log("Form submitted");
            createNewPost();
            location.reload();
        })

        const postName = document.getElementById('postName');
        const description = document.getElementById('description');
        const quantity = document.getElementById('quantity');

        console.log(postName.value, description.value, quantity.value);

        // for(let i = 1; i <= 10; i++) {
        //     console.log("LOOK AT THIS: " + document.getElementById(i));
        // }

        const buttonOne = document.getElementById('1');
        console.log("LOOK AT THIS: " + buttonOne);

        // MAKING A POST REQUEST TO THE REST API TO CREATE A NEW POST
        async function createNewPost() {
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");

            // const formData = {
            //     "postName": 
            // }

            var raw = JSON.stringify({
                "postName": postName.value,
                "description": description.value,
                "quantity": quantity.value
            });

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };

            const response= await fetch("http://localhost:4400/farmer/posts", requestOptions);
            const data = await response.json();
            console.log(data);
            
        }


        // function to show popup for updating post
        function togglePopup2() {
            document.getElementById('popup-2').classList.toggle("active");
        }

        const postNameUpdate = document.getElementById('postName-update');
        const descriptionUpdate = document.getElementById('description-update');
        const quantityUpdate = document.getElementById('quantity-update');

        // MAKING PUT REQUEST TO THE REST API TO UPDATE POST
        async function updatePost() {
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            var raw = JSON.stringify({
                "id": position,
                "postName": postNameUpdate.value,
                "description": descriptionUpdate.value,
                "quantity": quantityUpdate.value
            });

            var requestOptions = {
                method: 'PUT',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };

            const response = await fetch("http://localhost:4400/farmer/posts", requestOptions);
            const data = await response.json();
            console.log(data);
            console.log("POSITION: " + position);
        }

        // function update() {
        //     // console.log("Edit button is clicked");
        //     // console.log(document.querySelector('.post-id').innerHTML);
        //     const postIDs = document.querySelectorAll('.post-id');
        //     for (let i = 0; i < postIDs.length; i++) {
        //         console.log(postIDs[i]);
        //     }
        //     console.log("THESE ARE ALL THE POST IDs: " + postIDs[0]);
        //     updatePost();
        // }


        const updatePostForm = document.getElementById('update-post-form');
        updatePostForm.addEventListener('submit', (e) => {
            e.preventDefault();
            console.log("Form submitted");
            console.log("About to submit the update form");
            updatePost();
            location.reload();
        })
        

        
        module.exports = {
            postID
        }
    </script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
</body>

</html>